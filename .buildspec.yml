version: 0.2

env:
  parameter-store:
    S3_BUILD_ARTIFACTS_BUCKET: "build.artifacts.bucketname"
    S3_BUILD_ARTIFACTS_BUCKET_REGION: "build.artifacts.bucket.region"
    S3_BUILD_ARTIFACTS_ACCESS_KEY: "build.artifacts.s3.access.key"
    S3_BUILD_ARTIFACTS_SECRET_KEY: "build.artifacts.s3.secret.key"

phases:
  build:
    commands:
      - echo "Enter build stage..."
      - npm --version
      - cd ucla-prrla; npm install; node_modules/.bin/ng build --no-progress
      - tar -zcvf test-prl.tar.gz dist
      - rm -rf dist
      - node_modules/.bin/ng build --env=prod --no-sourcemap --no-progress
      - tar -zcvf prod-prl.tar.gz dist
      - echo "Contents to copy to S3..."
      - ls -la *.tar.gz
  post_build:
    commands:
      - aws s3 ls s3://${S3_BUILD_ARTIFACTS_BUCKET}
